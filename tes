import requests
from requests.exceptions import ProxyError, RequestException

def test_proxy_connection_with_session(proxy: tuple):
    """
    Тестирует соединение через прокси с использованием объекта Session.
    :param proxy: Кортеж с данными прокси (2, ip, port, True, login, password).
    """
    proxy_url = f"http://{proxy[4]}:{proxy[5]}@{proxy[1]}:{proxy[2]}"
    proxies = {
        'http': proxy_url,
        'https': proxy_url,
    }
    test_url = "https://api.ipify.org?format=json"  # Сервис для проверки внешнего IP

    print(f"Testing proxy with Session: {proxy_url}")

    # Создаём сессию
    session = requests.Session()
    session.proxies = proxies

    try:
        response = session.get(test_url, timeout=10)
        response.raise_for_status()
        print(f"Proxy test successful! Response: {response.json()}")
    except ProxyError as e:
        print(f"Proxy error: {e}")
    except RequestException as e:
        print(f"Request failed: {e}")
    except Exception as e:
        print(f"An unexpected error occurred: {e}")
    finally:
        session.close()

# Пример использования
proxy = (2, '188.130.142.148', '1050', True, 'gwNf9l', '6g2sYtNVEo')
test_proxy_connection_with_session(proxy)

